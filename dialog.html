<!DOCTYPE html>
<html lang="hu">
  <head>
    <script src="index.min.js"></script>
    <meta charset="UTF-8">
    <title>Ablak és Ajtó Méret Generátor</title>
    <style>
      /* Previous styles remain unchanged */
      body {
        font-family: Arial, sans-serif;
        margin: 10px;
        background-color: #2c2c2c;
        color: #e0e0e0;
      }
  
      h1, h2, h3 {
        margin-top: 20px;
        text-align: center;
        color: #ffa500;
      }
  
      .tab {
        display: none;
      }
  
      .tab.active {
        display: block;
      }
  
      .tabs {
        text-align: center;
        margin-bottom: 20px;
      }
  
      .tabs button {
        margin-right: 5px;
        padding: 10px 20px;
        cursor: pointer;
        background-color: #4CAF50;
        border: none;
        border-radius: 4px;
        color: white;
        font-weight: bold;
      }
  
      .tabs button:hover {
        background-color: #45a049;
      }
  
      .form-group {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        background-color: #444;
        padding: 20px;
        border-radius: 4px;
        margin-bottom: 20px;
      }
  
      .form-item {
        flex: 1 1 calc(50% - 20px);
        margin: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
  
      .form-item label {
        display: block;
        text-align: center;
        margin-bottom: 5px;
        font-weight: bold;
        color: #e0e0e0;
        width: 100%;
      }
  
      .form-item input[type="number"], .form-item select, .manual-settings input[type="number"] {
        width: 100%;
        max-width: 150px;
        padding: 10px;
        border: 1px solid #777;
        border-radius: 4px;
        background-color: #555;
        color: #fff;
        margin: 0 auto;
      }

      .form-item input[type="checkbox"] {
        margin: 10px auto;
      }
  
      .form-button {
        text-align: center;
        margin-top: 20px;
      }
  
      button {
        padding: 10px 20px;
        margin: 10px;
        cursor: pointer;
        background-color: #2196F3;
        border: none;
        border-radius: 4px;
        color: white;
        font-weight: bold;
      }
  
      button:hover {
        background-color: #1976D2;
      }
  
      .component-list {
        margin-top: 20px;
        background-color: #444;
        padding: 20px;
        border-radius: 4px;
      }
  
      .component-list p {
        margin: 5px 0;
      }
  
      .component-list button {
        margin-left: 10px;
        background-color: #FF5722;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        color: white;
        cursor: pointer;
      }
  
      .component-list button:hover {
        background-color: #E64A19;
      }
  
      .section {
        background-color: #555;
        color: #ffa500;
        padding: 10px;
        border-radius: 4px;
        text-align: center;
        margin-bottom: 20px;
        width: 100%;
      }
  
      #doorPreviewCanvas, #interiorDoorPreviewCanvas, #electricBoxDoorPreviewCanvas {
        border: 1px solid #333;
        margin-top: 20px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        width: 600px;
        height: 1000px;
      }
  
      .manual-settings {
        margin-top: 10px;
        padding: 15px;
        border: 1px solid #777;
        border-radius: 4px;
        background-color: #333;
      }
  
      /* Új stílus a dinamikusan generált form-item elemekhez */
      #door-horizontal-positions .form-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 10px auto;
        width: 100%;
      }

      #door-horizontal-positions .form-item label {
        width: 100%;
        text-align: center;
        margin-bottom: 5px;
      }

      #door-horizontal-positions .form-item input {
        width: 100%;
        max-width: 150px;
        padding: 8px;
        border: 1px solid #777;
        border-radius: 4px;
        background-color: #555;
        color: #fff;
        margin: 0 auto;
        display: block;
      }
    </style>
  </head>
  <body>
    <h1>Ablak és Ajtó Generátor</h1>
  
    <div class="tabs">
      <button onclick="showTab('windowTab')">Ablakok</button>
      <button onclick="showTab('doorTab')">Ajtók</button>
      <button onclick="showTab('interiorDoorTab')">Beltéri ajtók</button>
      <button onclick="showTab('electricBoxDoorTab')">Villanyóra szekrény ajtó</button>
    </div>

    <script>
    // Debug: Fabric.js ellenőrzése
    window.addEventListener('load', function() {
      console.log("Oldal betöltve, Fabric.js ellenőrzése");
      if (typeof fabric !== 'undefined') {
        console.log("Fabric.js sikeresen betöltve");
      } else {
        console.error("HIBA: Fabric.js nem töltődött be!");
      }
    });
    </script>
  
    <!-- Ablakok fül -->
    <div id="windowTab" class="tab active">
      <h2>Ablak Paraméterek</h2>
  
      <h3 class="section">Tok Külméretek</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="frame_width">Tok szélesség (mm):</label>
          <input type="number" id="frame_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="frame_height">Tok magasság (mm):</label>
          <input type="number" id="frame_height" step="0.1" min="0">
        </div>
      </div>
  
      <h3 class="section">Faanyag Keresztmetszetek</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="frame_wood_width">Tok anyag szélesség (mm):</label>
          <input type="number" id="frame_wood_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="frame_wood_thickness">Tok anyag vastagság (mm):</label>
          <input type="number" id="frame_wood_thickness" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="sash_wood_width">Nyíló anyag szélesség (mm):</label>
          <input type="number" id="sash_wood_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="sash_wood_thickness">Nyíló anyag vastagság (mm):</label>
          <input type="number" id="sash_wood_thickness" step="0.1" min="0">
        </div>
      </div>
  
      <h3 class="section">Ablak Típus Választása</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="window_type">Ablak típus:</label>
          <select id="window_type">
            <option value="Egyszárnyú">Egyszárnyú</option>
            <option value="Kétszárnyú">Kétszárnyú</option>
            <option value="Tokosztós">Tokosztós</option>
            <option value="Üvegfal">Üvegfal</option>
          </select>
        </div>
      </div>
  
      <h3 class="section">Nyíló Méret Számítás</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="sash_width_deduction">Nyíló szélesség levonás (mm):</label>
          <input type="number" id="sash_width_deduction" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="sash_height_deduction">Nyíló magasság levonás (mm):</label>
          <input type="number" id="sash_height_deduction" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="sash_double_deduction">Kétszárnyú/tokosztós levonás (mm):</label>
          <input type="number" id="sash_double_deduction" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="window_count">Darabszám:</label>
          <input type="number" id="window_count" min="1" value="1">
        </div>
      </div>
  
      <div class="form-button">
        <button onclick="submitWindowParams()">Ablak Generálása</button>
      </div>
    </div>
  
    <!-- Ajtók fül -->
    <div id="doorTab" class="tab">
      <h2>Ajtó Paraméterek</h2>
      <h3 class="section">Tok Külméretek</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="door_frame_width">Tok szélesség (mm):</label>
          <input type="number" id="door_frame_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_frame_height">Tok magasság (mm):</label>
          <input type="number" id="door_frame_height" step="0.1" min="0">
        </div>
      </div>
      <h3 class="section">Ajtó Típus Választása</h3>
      <div class="form-group">
          <div class="form-item">
              <label for="door_type">Ajtó típus:</label>
              <select id="door_type" onchange="handleDoorTypeChange()">
                  <option value="Egyszárnyú">Egyszárnyú</option>
                  <option value="Kétszárnyú">Kétszárnyú</option>
              </select>
          </div>
      </div>
      
      <div id="asymmetricOptions" class="form-group" style="display: none;">
          <div class="form-item">
              <input type="checkbox" id="isAsymmetric" onchange="handleAsymmetricChange()">
              <label for="isAsymmetric">Aszimmetrikus felosztás</label>
              
              <div id="asymmetricInputs" style="display: none;">
                  <div class="form-item">
                      <label for="mainWingRatio">Szélesebb szárny aránya (%):</label>
                      <input type="number" id="mainWingRatio" value="60" min="50" max="70">
                  </div>
                  <div class="form-item">
                    Keskenyebb szárnyba ne kerüljön függőleges osztó:
                    <input type="checkbox" id="disableNarrowWingVerticalDivisions" />
                  </div>
                </div>
              </div>
            </div>
      
      <div class="form-group">
          <div class="form-item">
              <label for="useAluminumThreshold">Alumínium küszöb használata:</label>
              <input type="checkbox" id="useAluminumThreshold">
          </div>
          <div class="form-item" id="aluminumThresholdThicknessContainer" style="display: none;">
              <label for="aluminumThresholdThickness">Alumínium küszöb vastagsága (mm):</label>
              <input type="number" id="aluminumThresholdThickness" step="0.1" min="0" value="0">
          </div>
      </div>
    
      
      <h3 class="section">Faanyag Keresztmetszetek</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="door_frame_wood_width">Tok anyag szélesség (mm):</label>
          <input type="number" id="door_frame_wood_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_frame_wood_thickness">Tok anyag vastagság (mm):</label>
          <input type="number" id="door_frame_wood_thickness" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_sash_width_deduction">Nyíló szélesség levonás (mm):</label>
          <input type="number" id="door_sash_width_deduction" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_sash_height_deduction">Nyíló magasság levonás (mm):</label>
          <input type="number" id="door_sash_height_deduction" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_count">Darabszám:</label>
          <input type="number" id="door_count" min="1" value="1">
        </div>
      </div>
  
      <h3 class="section">Csap Hossza</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="door_tenon_length">Csap hossza (mm):</label>
          <input type="number" id="door_tenon_length" step="0.1" min="0">
        </div>
      </div>
  
      <h3 class="section">Ajtó Fríz</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="door_frieze_width">Ajtó fríz szélessége (mm):</label>
          <input type="number" id="door_frieze_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_frieze_thickness">Ajtó fríz vastagsága (mm):</label>
          <input type="number" id="door_frieze_thickness" step="0.1" min="0">
        </div>
      </div>
  
      <h3 class="section">Alsó Csapos</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="door_lower_tenoned_width">Alsó csapos szélessége (mm):</label>
          <input type="number" id="door_lower_tenoned_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_lower_tenoned_thickness">Alsó csapos vastagsága (mm):</label>
          <input type="number" id="door_lower_tenoned_thickness" step="0.1" min="0">
        </div>
      </div>
  
      <h3 class="section">Középső Vízszintes Osztók</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="door_middle_division_width">Középső osztók szélessége (mm):</label>
          <input type="number" id="door_middle_division_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_middle_division_thickness">Középső osztók vastagsága (mm):</label>
          <input type="number" id="door_middle_division_thickness" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_horizontal_divisions">Vízszintes osztások száma:</label>
          <input type="number" id="door_horizontal_divisions" min="1" value="1">
        </div>
      </div>
  
      <h3 class="section">Felső Csapos</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="door_upper_tenoned_width">Felső csapos szélessége (mm):</label>
          <input type="number" id="door_upper_tenoned_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_upper_tenoned_thickness">Felső csapos vastagsága (mm):</label>
          <input type="number" id="door_upper_tenoned_thickness" step="0.1" min="0">
        </div>
      </div>
  
      <h3 class="section">Függőleges Osztók</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="door_vertical_division_width">Függőleges osztók szélessége (mm):</label>
          <input type="number" id="door_vertical_division_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_vertical_division_thickness">Függőleges osztók vastagsága (mm):</label>
          <input type="number" id="door_vertical_division_thickness" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="door_vertical_divisions">Függőleges osztások száma:</label>
          <input type="number" id="door_vertical_divisions" min="1" value="1">
        </div>
      </div>
  
      <div class="form-group">
        <div class="form-item">
          <label for="door-manual-settings-checkbox">Manuális beállítások: <span style="font-weight: normal; font-size: 0.9em; color: #ffa500;">(Először állítsd be a vízszintes osztások darabszámát fentebb!)</span></label>
          <input type="checkbox" id="door-manual-settings-checkbox">
        </div>
      </div>
  
      <div id="door-manual-settings" class="manual-settings" style="display: none;">
        <div id="door-horizontal-positions"></div>
        <div id="door-vertical-positions"></div>
      </div>

      <div class="form-button">
        <button onclick="submitDoorParams()">Ajtó Generálása</button>
      </div>
  
      <!-- Ajtó előnézet canvas -->
      <h3>Ajtó Előnézet</h3>
      <canvas id="doorPreviewCanvas" width="600" height="1000"></canvas>
    </div>
  
  <!-- Beltéri ajtók fül -->
  <div id="interiorDoorTab" class="tab">
    <h2>Beltéri Ajtó Paraméterek</h2>
    <h3 class="section">Tok Külméretek</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="interior_door_frame_width">Tok szélesség (mm):</label>
          <input type="number" id="interior_door_frame_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="interior_door_frame_height">Tok magasság (mm):</label>
          <input type="number" id="interior_door_frame_height" step="0.1" min="0">
        </div>
      </div>

    <h3 class="section">Faanyag Keresztmetszetek</h3> 
    <div class="form-group">
      <div class="form-item">
        <label for="interior_door_frame_wood_width">Tok anyag szélesség (mm):</label>
        <input type="number" id="interior_door_frame_wood_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_door_frame_wood_thickness">Tok anyag vastagság (mm):</label>
        <input type="number" id="interior_door_frame_wood_thickness" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_door_sash_width_deduction">Nyíló szélesség levonás (mm):</label>
        <input type="number" id="interior_door_sash_width_deduction" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_door_sash_height_deduction">Nyíló magasság levonás (mm):</label>
        <input type="number" id="interior_door_sash_height_deduction" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_door_count">Darabszám:</label>
        <input type="number" id="interior_door_count" min="1" value="1">
      </div>
    </div>
  
    <h3 class="section">Csap Hossza</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="interior_tenon_length">Csap hossza (mm):</label>
        <input type="number" id="interior_tenon_length" step="0.1" min="0">
      </div>
    </div>
  
    <h3 class="section">Ajtó Fríz</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="interior_door_frieze_width">Ajtó fríz szélessége (mm):</label>
        <input type="number" id="interior_door_frieze_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_door_frieze_thickness">Ajtó fríz vastagsága (mm):</label>
        <input type="number" id="interior_door_frieze_thickness" step="0.1" min="0">
      </div>
    </div>
  
    <h3 class="section">Alsó Csapos</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="interior_lower_tenoned_width">Alsó csapos szélessége (mm):</label>
        <input type="number" id="interior_lower_tenoned_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_lower_tenoned_thickness">Alsó csapos vastagsága (mm):</label>
        <input type="number" id="interior_lower_tenoned_thickness" step="0.1" min="0">
      </div>
    </div>
  
    <h3 class="section">Középső Vízszintes Osztók</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="interior_middle_division_width">Középső osztók szélessége (mm):</label>
        <input type="number" id="interior_middle_division_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_middle_division_thickness">Középső osztók vastagsága (mm):</label>
        <input type="number" id="interior_middle_division_thickness" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_horizontal_divisions">Vízszintes osztások száma:</label>
        <input type="number" id="interior_horizontal_divisions" min="1" value="1">
      </div>
    </div>
  
    <h3 class="section">Felső Csapos</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="interior_upper_tenoned_width">Felső csapos szélessége (mm):</label>
        <input type="number" id="interior_upper_tenoned_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_upper_tenoned_thickness">Felső csapos vastagsága (mm):</label>
        <input type="number" id="interior_upper_tenoned_thickness" step="0.1" min="0">
      </div>
    </div>
  
    <h3 class="section">Függőleges Osztók</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="interior_vertical_division_width">Függőleges osztók szélessége (mm):</label>
        <input type="number" id="interior_vertical_division_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_vertical_division_thickness">Függőleges osztók vastagsága (mm):</label>
        <input type="number" id="interior_vertical_division_thickness" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="interior_vertical_divisions">Függőleges osztások száma:</label>
        <input type="number" id="interior_vertical_divisions" min="1" value="1">
      </div>
    </div>
  
    <div class="form-button">
      <button onclick="submitInteriorDoorParams()">Beltéri Ajtó Generálása</button>
    </div>
  
    <!-- Beltéri ajtó előnézet canvas -->
    <h3>Beltéri Ajtó Előnézet</h3>
    <canvas id="interiorDoorPreviewCanvas" width="600" height="1000"></canvas>
  </div>
  <!-- Villanyóra szekrény ajtó fül -->
  <div id="electricBoxDoorTab" class="tab">
    <h2>Villanyóra Szekrény Ajtó Paraméterek</h2>
    <h3 class="section">Tok Külméretek</h3>
      <div class="form-group">
        <div class="form-item">
          <label for="electric_box_door_frame_width">Tok szélesség (mm):</label>
          <input type="number" id="electric_box_door_frame_width" step="0.1" min="0">
        </div>
        <div class="form-item">
          <label for="electric_box_door_frame_height">Tok magasság (mm):</label>
          <input type="number" id="electric_box_door_frame_height" step="0.1" min="0">
        </div>
      </div>
    <h3 class="section">Faanyag Keresztmetszetek</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="electric_box_door_frame_wood_width">Tok anyag szélesség (mm):</label>
        <input type="number" id="electric_box_door_frame_wood_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_door_frame_wood_thickness">Tok anyag vastagság (mm):</label>
        <input type="number" id="electric_box_door_frame_wood_thickness" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_door_sash_width_deduction">Nyíló szélesség levonás (mm):</label>
        <input type="number" id="electric_box_door_sash_width_deduction" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_door_sash_height_deduction">Nyíló magasság levonás (mm):</label>
        <input type="number" id="electric_box_door_sash_height_deduction" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_door_count">Darabszám:</label>
        <input type="number" id="electric_box_door_count" min="1" value="1">
      </div>
    </div>
  
    <h3 class="section">Csap Hossza</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="electric_box_tenon_length">Csap hossza (mm):</label>
        <input type="number" id="electric_box_tenon_length" step="0.1" min="0">
      </div>
    </div>
  
    <h3 class="section">Ajtó Fríz</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="electric_box_door_frieze_width">Ajtó fríz szélessége (mm):</label>
        <input type="number" id="electric_box_door_frieze_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_door_frieze_thickness">Ajtó fríz vastagsága (mm):</label>
        <input type="number" id="electric_box_door_frieze_thickness" step="0.1" min="0">
      </div>
    </div>
  
    <h3 class="section">Alsó Csapos</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="electric_box_lower_tenoned_width">Alsó csapos szélessége (mm):</label>
        <input type="number" id="electric_box_lower_tenoned_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_lower_tenoned_thickness">Alsó csapos vastagsága (mm):</label>
        <input type="number" id="electric_box_lower_tenoned_thickness" step="0.1" min="0">
      </div>
    </div>
  
    <h3 class="section">Középső Vízszintes Osztók</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="electric_box_middle_division_width">Középső osztók szélessége (mm):</label>
        <input type="number" id="electric_box_middle_division_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_middle_division_thickness">Középső osztók vastagsága (mm):</label>
        <input type="number" id="electric_box_middle_division_thickness" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_horizontal_divisions">Vízszintes osztások száma:</label>
        <input type="number" id="electric_box_horizontal_divisions" min="1" value="1">
      </div>
    </div>
  
    <h3 class="section">Felső Csapos</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="electric_box_upper_tenoned_width">Felső csapos szélessége (mm):</label>
        <input type="number" id="electric_box_upper_tenoned_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_upper_tenoned_thickness">Felső csapos vastagsága (mm):</label>
        <input type="number" id="electric_box_upper_tenoned_thickness" step="0.1" min="0">
      </div>
    </div>
  
    <h3 class="section">Függőleges Osztók</h3>
    <div class="form-group">
      <div class="form-item">
        <label for="electric_box_vertical_division_width">Függőleges osztók szélessége (mm):</label>
        <input type="number" id="electric_box_vertical_division_width" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_vertical_division_thickness">Függőleges osztók vastagsága (mm):</label>
        <input type="number" id="electric_box_vertical_division_thickness" step="0.1" min="0">
      </div>
      <div class="form-item">
        <label for="electric_box_vertical_divisions">Függőleges osztások száma:</label>
        <input type="number" id="electric_box_vertical_divisions" min="1" value="1">
      </div>
    </div>
  
    <div class="form-button">
      <button onclick="submitElectricBoxDoorParams()">Villanyóra Szekrény Ajtó Generálása</button>
    </div>
  
    <!-- Villanyóra szekrény ajtó előnézet canvas -->
    <h3>Villanyóra Szekrény Ajtó Előnézet</h3>
    <canvas id="electricBoxDoorPreviewCanvas" width="600" height="1000"></canvas>
  </div>
  
    <!-- Generált elemlista -->
    <div class="component-list" id="componentList">
      <h2>Generált Elemlista</h2>
      <div id="componentListContent"></div>
      
      <!-- Lista műveletek -->
      <div class="list-actions">
        <button class="action-button" onclick="saveList()">Lista mentése</button>
        <button class="action-button" onclick="printList()">Lista nyomtatása</button>
      </div>
    </div>
  
    <!-- Alkatrészek létrehozása gomb -->
    <div class="form-button">
      <button onclick="generateComponents()">Alkatrészek Létrehozása</button>
    </div>

  <script>
    // 1. Canvas változók deklarálása
    var canvas = new fabric.Canvas('doorPreviewCanvas');
    var interiorCanvas = new fabric.Canvas('interiorDoorPreviewCanvas');
    var electricBoxCanvas = new fabric.Canvas('electricBoxDoorPreviewCanvas');

    // 2. showTab függvény
    function showTab(tabId) {
        document.querySelectorAll('.tab').forEach(function(tab) {
            tab.classList.remove('active');
            tab.style.display = 'none';
        });
        var selectedTab = document.getElementById(tabId);
        if (selectedTab) {
            selectedTab.classList.add('active');
            selectedTab.style.display = 'block';
        }
    }

    // 3. window.onload eseménykezelő
    window.onload = function() {
        showTab('windowTab');
        loadFormValues();
        
        document.querySelectorAll('#interiorDoorTab input[type="number"]').forEach(function(input) {
            input.addEventListener('input', function() {
                var params = collectInteriorDoorParams();
                if (params) {
                    drawInteriorDoor(params);
                }
            });
        });

        document.querySelectorAll('#electricBoxDoorTab input[type="number"]').forEach(function(input) {
            input.addEventListener('input', function() {
                var params = collectElectricBoxDoorParams();
                if (params) {
                    drawElectricBoxDoor(params);
                }
            });
        });
    };
    
    document.addEventListener('DOMContentLoaded', function() {
      // Automatikus frissítés beállítása
      function setupAutomaticRefresh() {
        // Paraméterek, amelyek változása esetén frissítjük az ajtó rajzát
        var doorParams = [
            'door_frame_width', 'door_frame_height', 'door_frieze_width',
            'door_tenon_length', 'door_lower_tenoned_width', 'door_upper_tenoned_width',
            'door_vertical_divisions', 'door_horizontal_divisions', 'door_middle_division_width',
            'door_vertical_division_width'
        ];
    
        // Eseménykezelők hozzáadása minden mezőhöz
        doorParams.forEach(function(paramId) {
            var element = document.getElementById(paramId);
            if (element) {
                element.addEventListener('change', function() {
                    var params = collectDoorParams();
                    if (params) {
                        drawDoor(params);
                    }
                });
                element.addEventListener('input', function() {
                    var params = collectDoorParams();
                    if (params) {
                        drawDoor(params);
                    }
                });
            } else {
                console.log("Elem nem található: " + paramId);
            }
        });
    }
    
    // Manuális beállítások checkbox
    var manualSettingsCheckbox = document.getElementById('door-manual-settings-checkbox');
    if (manualSettingsCheckbox) {
        manualSettingsCheckbox.addEventListener('change', function() {
            var params = collectDoorParams();
            if (params) {
                drawDoor(params);
            }
        });
    }
    
    // Manuális távolságok konténere
    var manualDistancesContainer = document.getElementById('manual-horizontal-distances-container');
    if (manualDistancesContainer) {
        manualDistancesContainer.addEventListener('change', function(e) {
            if (e.target && e.target.classList.contains('distance-input')) {
                var params = collectDoorParams();
                if (params) {
                    drawDoor(params);
                }
            }
        });
    }
 
    // Automatikus frissítés beállítása
    setupAutomaticRefresh();
 
     // Kezdeti rajz létrehozása az alapértelmezett paraméterekkel
     setTimeout(function() {
          // Kezdeti rajzoláskor ne ellenőrizzük a mezőket, így nem dob hibaüzenetet
          try {
              // Eredeti collectDoorParams másolata validáció nélkül
              var doorFrameWidth = document.getElementById('door_frame_width').value || 800;
              var doorFrameHeight = document.getElementById('door_frame_height').value || 2000;
              var doorFrameWoodWidth = document.getElementById('door_frame_wood_width').value || 80;
              var doorFrameWoodThickness = document.getElementById('door_frame_wood_thickness').value || 68;
              var doorFriezeWidth = document.getElementById('door_frieze_width').value || 80;
              var doorFriezeThickness = document.getElementById('door_frieze_thickness').value || 40;
              var tenonLength = document.getElementById('door_tenon_length').value || 25;
              var doorType = document.getElementById('door_type').value;  // Itt javítottuk az ID-t
              var doorSashWidthDeduction = document.getElementById('door_sash_width_deduction').value || 30;
              var doorSashHeightDeduction = document.getElementById('door_sash_height_deduction').value || 30;
              var doorCount = document.getElementById('door_count').value || 1;
              var horizontalDivisions = document.getElementById('door_horizontal_divisions').value || 1;
              var verticalDivisions = document.getElementById('door_vertical_divisions').value || 1;
              
              // Minimális paraméterek az első rajzoláshoz
              var defaultParams = {
                  element_type: "Ajtó",
                  door_frame_width: doorFrameWidth,
                  door_frame_height: doorFrameHeight,
                  door_frame_wood_width: doorFrameWoodWidth,
                  door_frame_wood_thickness: doorFrameWoodThickness,
                  door_frieze_width: doorFriezeWidth,
                  door_frieze_thickness: doorFriezeThickness,
                  tenon_length: tenonLength,
                  door_type: doorType,
                  door_sash_width_deduction: doorSashWidthDeduction,
                  door_sash_height_deduction: doorSashHeightDeduction,
                  door_count: doorCount,
                  horizontal_divisions: parseInt(horizontalDivisions),
                  vertical_divisions: parseInt(verticalDivisions),
                  lower_tenoned_width: document.getElementById('door_lower_tenoned_width').value || 80,
                  lower_tenoned_thickness: document.getElementById('door_lower_tenoned_thickness').value || 40,
                  middle_division_width: document.getElementById('door_middle_division_width').value || 80,
                  middle_division_thickness: document.getElementById('door_middle_division_thickness').value || 40,
                  upper_tenoned_width: document.getElementById('door_upper_tenoned_width').value || 80,
                  upper_tenoned_thickness: document.getElementById('door_upper_tenoned_thickness').value || 40,
                  vertical_division_width: document.getElementById('door_vertical_division_width').value || 80,
                  vertical_division_thickness: document.getElementById('door_vertical_division_thickness').value || 40
              };
              
              console.log("Kezdeti betöltés paraméterek:", defaultParams);
              
              // Használjuk az alapértelmezett paramétereket
              if (defaultParams) {
                  drawDoor(defaultParams);
              }
              
              // Beltéri ajtó és villanyóra ajtó előnézetek hasonló módon...
              
          } catch (e) {
              console.log("Hiba történt a kezdeti rajzolás során:", e);
              // Nem dobunk hibaüzenetet felugró ablakban
          }
      }, 500);
    // Meglévő elemek kiválasztása
    const doorTypeSelect = document.getElementById('door_type');
    const asymmetricOptions = document.getElementById('asymmetricOptions');
    const asymmetricCheckbox = document.getElementById('isAsymmetric');
    const asymmetricInputs = document.getElementById('asymmetricInputs');
    const mainWingRatio = document.getElementById('mainWingRatio');
    const disableNarrowWingVerticalDivisions = document.getElementById('disableNarrowWingVerticalDivisions');
    const useAluminumThresholdCheckbox = document.getElementById('useAluminumThreshold');
    const aluminumThresholdThicknessContainer = document.getElementById('aluminumThresholdThicknessContainer');


    // Ajtó típus változás eseménykezelő
    doorTypeSelect?.addEventListener('change', function() {
        const isDouble = this.value === 'Kétszárnyú';
        asymmetricOptions.style.display = isDouble ? 'block' : 'none';
        if (!isDouble) {
            asymmetricCheckbox.checked = false;
            asymmetricInputs.style.display = 'none';
        }
        
        // Frissítjük a rajzot az ajtó típus változásakor
        var params = collectDoorParams();
        if (params) {
            drawDoor(params);
        }
        
        // Callback az ajtó típus változásra
        if (window.sketchup) {
            window.sketchup.doorTypeChanged(JSON.stringify({
                doorType: this.value,
                isAsymmetric: asymmetricCheckbox.checked,
                mainWingRatio: mainWingRatio.value,
                disableNarrowWingVerticalDivisions: disableNarrowWingVerticalDivisions.checked
            }));
        }
    });

    // Aszimmetrikus beállítás változás eseménykezelő
    asymmetricCheckbox?.addEventListener('change', function() {
        asymmetricInputs.style.display = this.checked ? 'block' : 'none';
        if (window.sketchup) {
            window.sketchup.updateAsymmetricSettings(JSON.stringify({
                isAsymmetric: this.checked,
                mainWingRatio: mainWingRatio.value,
                disableNarrowWingVerticalDivisions: disableNarrowWingVerticalDivisions.checked
            }));
        }
    });
    
    // Frissítjük a rajzot az aszimmetrikus beállítás változásakor is
    var params = collectDoorParams();
    if (params) {
        drawDoor(params);
    }
    
    // Függőleges osztó kapcsoló eseménykezelő
    disableNarrowWingVerticalDivisions?.addEventListener('change', function() {
        if (window.sketchup) {
            window.sketchup.updateAsymmetricSettings(JSON.stringify({
                isAsymmetric: asymmetricCheckbox.checked,
                mainWingRatio: mainWingRatio.value,
                disableNarrowWingVerticalDivisions: this.checked
            }));
        }
    });

    // Alumínium küszöb checkbox eseménykezelő
    useAluminumThresholdCheckbox?.addEventListener('change', function() {
        aluminumThresholdThicknessContainer.style.display = this.checked ? 'block' : 'none';
    });

    // Itt folytatódnak a meglévő eseménykezelők...
});

    // Add event listener for aluminum threshold checkbox
    const aluminumThresholdCheckbox = document.getElementById('useAluminumThreshold');
    if (aluminumThresholdCheckbox) {
        aluminumThresholdCheckbox.addEventListener('change', function() {
            console.log('Aluminum threshold setting changed:', this.checked);
            // Ha szükséges, itt frissíthetjük az előnézetet vagy más elemeket
            var params = collectDoorParams();
            if (params) {
                drawDoor(params);
            }
        });
    }

    // 4. Ablak függvények
    function submitWindowParams() {
        var params = collectWindowParams();
        if (params) {
            saveFormValues();
            sketchup.generateComponents(JSON.stringify(params));
        }
    }

    function collectWindowParams() {
        var frameWoodWidth = document.getElementById('frame_wood_width').value;
        var frameWoodThickness = document.getElementById('frame_wood_thickness').value;
        var sashWoodWidth = document.getElementById('sash_wood_width').value;
        var sashWoodThickness = document.getElementById('sash_wood_thickness').value;
        var windowType = document.getElementById('window_type').value;
        var frameWidth = document.getElementById('frame_width').value;
        var frameHeight = document.getElementById('frame_height').value;
        var sashWidthDeduction = document.getElementById('sash_width_deduction').value;
        var sashHeightDeduction = document.getElementById('sash_height_deduction').value;
        var sashDoubleDeduction = document.getElementById('sash_double_deduction').value;
        var windowCount = document.getElementById('window_count').value;

        if (!frameWoodWidth || !frameWoodThickness || !sashWoodWidth || !sashWoodThickness || !frameWidth || !frameHeight || !windowCount) {
            alert('Kérjük, töltse ki az összes kötelező mezőt.');
            return null;
        }

        return {
            element_type: "Ablak",
            frame_wood_width: frameWoodWidth,
            frame_wood_thickness: frameWoodThickness,
            sash_wood_width: sashWoodWidth,
            sash_wood_thickness: sashWoodThickness,
            window_type: windowType,
            frame_width: frameWidth,
            frame_height: frameHeight,
            sash_width_deduction: sashWidthDeduction,
            sash_height_deduction: sashHeightDeduction,
            sash_double_deduction: sashDoubleDeduction,
            window_count: windowCount
        };
    }

    // 5. Ajtó függvények
    function submitDoorParams() {
      canvas.clear(); // Előző rajz törlése
    var params = collectDoorParams();
    if (params) {
        saveFormValues();
        console.log("Ajtó paraméterek küldése:", params);
        sketchup.generateComponents(JSON.stringify(params));  // Ez a kulcsfontosságú sor
        drawDoor(params);
    }
}
    
   
function collectDoorParams() {
    // Értékek beolvasása az input mezőkből
    var doorframeWoodWidth = document.getElementById('door_frame_wood_width').value;
    var doorframeWoodThickness = document.getElementById('door_frame_wood_thickness').value;
    var doorframeWidth = document.getElementById('door_frame_width').value;
    var doorframeHeight = document.getElementById('door_frame_height').value;
    var doorSashWidthDeduction = document.getElementById('door_sash_width_deduction').value;
    var doorSashHeightDeduction = document.getElementById('door_sash_height_deduction').value;
    var doorType = document.getElementById('door_type').value;  // Itt javítottuk az ID-t
    var doorCount = document.getElementById('door_count').value;
    var tenonLength = document.getElementById('door_tenon_length').value;
    var doorFriezeWidth = document.getElementById('door_frieze_width').value;
    var doorFriezeThickness = document.getElementById('door_frieze_thickness').value;
    var lowerTenonedWidth = document.getElementById('door_lower_tenoned_width').value;
    var lowerTenonedThickness = document.getElementById('door_lower_tenoned_thickness').value;
    var middleDivisionWidth = document.getElementById('door_middle_division_width').value;
    var middleDivisionThickness = document.getElementById('door_middle_division_thickness').value;
    var horizontalDivisions = document.getElementById('door_horizontal_divisions').value;
    var upperTenonedWidth = document.getElementById('door_upper_tenoned_width').value;
    var upperTenonedThickness = document.getElementById('door_upper_tenoned_thickness').value;
    var verticalDivisionWidth = document.getElementById('door_vertical_division_width').value;
    var verticalDivisionThickness = document.getElementById('door_vertical_division_thickness').value;
    var verticalDivisions = document.getElementById('door_vertical_divisions').value;
    var isAsymmetric = document.getElementById('isAsymmetric').checked;
    var mainWingRatio = isAsymmetric && doorType === 'Kétszárnyú' ? 
        parseInt(document.getElementById('mainWingRatio').value) : 50;

         // Debug log a checkbox értékének ellenőrzéséhez
        console.log("Checkbox állapota:", document.getElementById('useAluminumThreshold').checked);
        
    var useAluminumThreshold = document.getElementById("useAluminumThreshold").checked;
    var aluminumThresholdThickness = useAluminumThreshold ? parseFloat(document.getElementById("aluminumThresholdThickness").value) || 0 : 0;
    var disableNarrowWingVerticalDivisions = document.getElementById('disableNarrowWingVerticalDivisions') ? document.getElementById('disableNarrowWingVerticalDivisions').checked : false;

    console.log("disableNarrowWingVerticalDivisions értéke:", disableNarrowWingVerticalDivisions);

    // Aszimmetrikus opciók beolvasása
    var isAsymmetric = document.getElementById('isAsymmetric').checked;
    var mainWingRatio = isAsymmetric && doorType === 'Kétszárnyú' ? 
        parseInt(document.getElementById('mainWingRatio').value) : 50;

    // Manuális beállítások ellenőrzése
    var manualHorizontalPositions = [];
    var manualVerticalPositions = [];

    if (document.getElementById('door-manual-settings-checkbox').checked) {
        var horizontalPositionsInputs = document.querySelectorAll('#door-horizontal-positions input[type="number"]');
        horizontalPositionsInputs.forEach(function(input) {
            manualHorizontalPositions.push(parseFloat(input.value));
        });
        var verticalPositionsInputs = document.querySelectorAll('#door-vertical-positions input[type="number"]');
        verticalPositionsInputs.forEach(function(input) {
            manualVerticalPositions.push(parseFloat(input.value));
        });
    }

    // Ellenőrzések
    if (!doorframeWoodWidth || !doorframeWoodThickness || !doorframeWidth || !doorframeHeight || !doorCount ||
        !tenonLength || !doorFriezeWidth || !doorFriezeThickness ||
        !lowerTenonedWidth || !lowerTenonedThickness ||
        !upperTenonedWidth || !upperTenonedThickness ||
        !verticalDivisionWidth || !verticalDivisionThickness) {
        return null;
    }

    // Visszatérés a paraméterekkel
    return {
        element_type: "Ajtó",
        door_frame_wood_width: doorframeWoodWidth,
        door_frame_wood_thickness: doorframeWoodThickness,
        door_frame_width: doorframeWidth,
        door_frame_height: doorframeHeight,
        door_sash_width_deduction: doorSashWidthDeduction,
        door_sash_height_deduction: doorSashHeightDeduction,
        door_type: doorType,
        door_count: doorCount,
        tenon_length: tenonLength,
        door_frieze_width: doorFriezeWidth,
        door_frieze_thickness: doorFriezeThickness,
        lower_tenoned_width: lowerTenonedWidth,
        lower_tenoned_thickness: lowerTenonedThickness,
        middle_division_width: middleDivisionWidth,
        middle_division_thickness: middleDivisionThickness,
        horizontal_divisions: parseInt(horizontalDivisions),
        upper_tenoned_width: upperTenonedWidth,
        upper_tenoned_thickness: upperTenonedThickness,
        vertical_division_width: verticalDivisionWidth,
        vertical_division_thickness: verticalDivisionThickness,
        vertical_divisions: parseInt(verticalDivisions),
        manualHorizontalPositions: manualHorizontalPositions,
        manualVerticalPositions: manualVerticalPositions,
        is_asymmetric: isAsymmetric,          // Új sor
        main_wing_ratio: mainWingRatio,       // Új sor
        useAluminumThreshold: document.getElementById('useAluminumThreshold').checked,
        aluminumThresholdThickness: document.getElementById('useAluminumThreshold').checked ? parseFloat(document.getElementById('aluminumThresholdThickness').value) || 0 : 0,
        disable_narrow_wing_vertical_divisions: disableNarrowWingVerticalDivisions
    };
}

function drawDoor(params) {
    console.log("drawDoor függvény meghívva a következő paraméterekkel:", params);
    canvas.clear();
    var scale = Math.min(600 / params.door_frame_width, 1000 / params.door_frame_height);
    var width = params.door_frame_width * scale;
    var height = params.door_frame_height * scale;
    var friezeWidth = (params.door_frieze_width || 0) * scale;
    var tenonLength = (params.tenon_length || 0) * scale;

    // Debug infó
    console.log("Canvas méretei:", width, "x", height);
    console.log("Fríz szélesség:", friezeWidth);
    console.log("Csap hossz:", tenonLength);

    // Háttér - világos a jobb kontrasztért sötét háttéren
    canvas.add(new fabric.Rect({
        left: 0,
        top: 0,
        width: width,
        height: height,
        fill: '#3f3f3f',
        stroke: '#888888',
        strokeWidth: 2
    }));

    // Csapos elemek méretei
    var lowerTenonedWidth = (params.lower_tenoned_width || 0) * scale;
    var upperTenonedWidth = (params.upper_tenoned_width || 0) * scale;
    var csaposWidth = width - (2 * friezeWidth) + (2 * tenonLength);

    // Kitöltés az üvegtábla számára - kicsit sötétebb
    canvas.add(new fabric.Rect({
        left: friezeWidth,
        top: upperTenonedWidth,
        width: width - (2 * friezeWidth),
        height: height - upperTenonedWidth - lowerTenonedWidth,
        fill: '#202530',
        stroke: '#777777',
        strokeWidth: 1
    }));

    // Alsó csapos - világos színű a jó láthatóságért
    canvas.add(new fabric.Rect({
        left: friezeWidth - tenonLength,
        top: height - lowerTenonedWidth,
        width: csaposWidth,
        height: lowerTenonedWidth,
        fill: '#b0b0b0',
        stroke: '#ffffff',
        strokeWidth: 1
    }));

    // Felső csapos - világos színű a jó láthatóságért
    canvas.add(new fabric.Rect({
        left: friezeWidth - tenonLength,
        top: 0,
        width: csaposWidth,
        height: upperTenonedWidth,
        fill: '#b0b0b0',
        stroke: '#ffffff',
        strokeWidth: 1
    }));

    // Csapok jelölése - világos vonalak
    // Felső csapok
    canvas.add(new fabric.Line([friezeWidth, 0, friezeWidth, upperTenonedWidth], {
        stroke: '#dddddd',
        strokeWidth: 0.5,
        strokeDashArray: [2, 2]
    }));
    
    canvas.add(new fabric.Line([width - friezeWidth, 0, width - friezeWidth, upperTenonedWidth], {
        stroke: '#dddddd',
        strokeWidth: 0.5,
        strokeDashArray: [2, 2]
    }));
    
    // Alsó csapok
    canvas.add(new fabric.Line([friezeWidth, height - lowerTenonedWidth, friezeWidth, height], {
        stroke: '#dddddd',
        strokeWidth: 0.5,
        strokeDashArray: [2, 2]
    }));
    
    canvas.add(new fabric.Line([width - friezeWidth, height - lowerTenonedWidth, width - friezeWidth, height], {
        stroke: '#dddddd',
        strokeWidth: 0.5,
        strokeDashArray: [2, 2]
    }));

    // Vízszintes osztók pozícióinak kiszámítása és tárolása
    var horizontalDivisionPositions = [];
    var divisionHeight = (params.middle_division_width || 0) * scale;
    
    console.log("Vízszintes osztók száma:", params.horizontal_divisions);
    console.log("Vízszintes osztó magasság:", divisionHeight);
    
    if (params.horizontal_divisions > 0) {
        var availableHeight = height - upperTenonedWidth - lowerTenonedWidth;
        
        // Ellenőrizzük, hogy vannak-e manuális pozíciók
        var useManualPositions = document.getElementById('door-manual-settings-checkbox').checked && 
                                params.manualHorizontalPositions && 
                                params.manualHorizontalPositions.length === parseInt(params.horizontal_divisions);
        
        if (useManualPositions) {
            // Manuális pozíciók használata - MINDIG az alsó csapostól kezdjük
            var currentPosition = height - lowerTenonedWidth;
            
            // Fordított sorrendben mérjük fel az osztók pozícióit, alulról felfelé haladva
            for (var i = 0; i < params.manualHorizontalPositions.length; i++) {
                // A manuális távolságot skálázzuk és felfelé haladunk (az alsó csaposból kiindulva)
                var manualDistance = params.manualHorizontalPositions[i] * scale;
                currentPosition -= manualDistance;
                
                // Tároljuk az osztó közepének pozícióját
                horizontalDivisionPositions.push(currentPosition);
                
                // Vízszintes osztó - világos
                canvas.add(new fabric.Rect({
                    left: friezeWidth - tenonLength,
                    top: currentPosition - divisionHeight/2,
                    width: csaposWidth,
                    height: divisionHeight,
                    fill: '#b0b0b0',
                    stroke: '#ffffff',
                    strokeWidth: 1
                }));
                
                // Csapok jelölése az osztón - világos vonalak
                canvas.add(new fabric.Line([friezeWidth, currentPosition - divisionHeight/2, friezeWidth, currentPosition + divisionHeight/2], {
                    stroke: '#dddddd',
                    strokeWidth: 0.5,
                    strokeDashArray: [2, 2]
                }));
                
                canvas.add(new fabric.Line([width - friezeWidth, currentPosition - divisionHeight/2, width - friezeWidth, currentPosition + divisionHeight/2], {
                    stroke: '#dddddd',
                    strokeWidth: 0.5,
                    strokeDashArray: [2, 2]
                }));
                
                // Hozzáadjuk az osztó szélességét a következő pozícióhoz (felfelé haladva)
                currentPosition -= divisionHeight;
            }
        } else {
            // Egyenletes eloszlás használata
            var spacing = availableHeight / (parseInt(params.horizontal_divisions) + 1);
            
            for (var i = 1; i <= params.horizontal_divisions; i++) {
                var y = upperTenonedWidth + (spacing * i);
                
                // Tároljuk az osztó közepének pozícióját
                horizontalDivisionPositions.push(y);
                
                // Vízszintes osztó - világos
                canvas.add(new fabric.Rect({
                    left: friezeWidth - tenonLength,
                    top: y - divisionHeight/2,
                    width: csaposWidth,
                    height: divisionHeight,
                    fill: '#b0b0b0',
                    stroke: '#ffffff',
                    strokeWidth: 1
                }));
                
                // Csapok jelölése az osztón - világos vonalak
                canvas.add(new fabric.Line([friezeWidth, y - divisionHeight/2, friezeWidth, y + divisionHeight/2], {
                    stroke: '#dddddd',
                    strokeWidth: 0.5,
                    strokeDashArray: [2, 2]
                }));
                
                canvas.add(new fabric.Line([width - friezeWidth, y - divisionHeight/2, width - friezeWidth, y + divisionHeight/2], {
                    stroke: '#dddddd',
                    strokeWidth: 0.5,
                    strokeDashArray: [2, 2]
                }));
            }
        }
    }

    // Horizontális osztók pozícióinak rendezése fentről lefelé (y érték szerint növekvő sorrendben)
    horizontalDivisionPositions.sort(function(a, b) {
        return a - b;
    });
    
    // Szegmensek határainak meghatározása (osztókkal együtt)
    var segments = [];
    
    // Első szegmens: felső csapostól az első vízszintes osztóig
    segments.push({
        top: upperTenonedWidth,
        bottom: horizontalDivisionPositions.length > 0 ? horizontalDivisionPositions[0] - divisionHeight/2 : height - lowerTenonedWidth
    });
    
    // Középső szegmensek: vízszintes osztók között
    for (var i = 0; i < horizontalDivisionPositions.length - 1; i++) {
        segments.push({
            top: horizontalDivisionPositions[i] + divisionHeight/2,
            bottom: horizontalDivisionPositions[i+1] - divisionHeight/2
        });
    }
    
    // Utolsó szegmens: utolsó vízszintes osztótól az alsó csaposig
    if (horizontalDivisionPositions.length > 0) {
        segments.push({
            top: horizontalDivisionPositions[horizontalDivisionPositions.length - 1] + divisionHeight/2,
            bottom: height - lowerTenonedWidth
        });
    }

    // Függőleges osztók
    var verticalDivisionCount = parseInt(params.vertical_divisions) || 0;
    var verticalDivisionWidth = (params.vertical_division_width || 0) * scale;

    console.log("Függőleges osztók száma:", verticalDivisionCount);
    console.log("Függőleges osztó szélesség:", verticalDivisionWidth);
    console.log("Ajtó típus:", params.door_type);
    
    if (params.door_type === 'Kétszárnyú') {
        var mainWingWidth = params.is_asymmetric ? 
            width * (params.main_wing_ratio / 100) : 
            width / 2;

        if (params.is_asymmetric) {
            // Aszimmetrikus kétszárnyú osztók
            var mainInnerWidth = mainWingWidth - (2 * friezeWidth);
            var secondInnerWidth = (width - mainWingWidth) - (2 * friezeWidth);
            
            if (verticalDivisionCount > 0) {
                // Szélesebb szárny osztói
                var mainDivSpacing = mainInnerWidth / (verticalDivisionCount + 1);
                for (var i = 1; i <= verticalDivisionCount; i++) {
                    var x = friezeWidth + (i * mainDivSpacing);
                    
                    // Rajzoljuk meg a függőleges osztót szegmensenként
                    for (var j = 0; j < segments.length; j++) {
                        var segment = segments[j];
                        canvas.add(new fabric.Rect({
                            left: x - verticalDivisionWidth/2,
                            top: segment.top,
                            width: verticalDivisionWidth,
                            height: segment.bottom - segment.top,
                            fill: '#b0b0b0',
                            stroke: '#ffffff',
                            strokeWidth: 1
                        }));
                    }
                }

                // Keskenyebb szárny osztói
                if (!params.disable_narrow_wing_vertical_divisions) {
                    var secondDivSpacing = secondInnerWidth / (verticalDivisionCount + 1);
                    for (var i = 1; i <= verticalDivisionCount; i++) {
                        var x = mainWingWidth + friezeWidth + (i * secondDivSpacing);
                        
                        // Rajzoljuk meg a függőleges osztót szegmensenként
                        for (var j = 0; j < segments.length; j++) {
                            var segment = segments[j];
                            canvas.add(new fabric.Rect({
                                left: x - verticalDivisionWidth/2,
                                top: segment.top,
                                width: verticalDivisionWidth,
                                height: segment.bottom - segment.top,
                                fill: '#b0b0b0',
                                stroke: '#ffffff',
                                strokeWidth: 1
                            }));
                        }
                    }
                }
            }

            // Aszimmetrikus frízek - fa színű
            canvas.add(new fabric.Rect({
                left: 0, 
                top: 0, 
                width: friezeWidth, 
                height: height, 
                fill: '#a86d3b', 
                stroke: '#ffffff', 
                strokeWidth: 1
            }));
            canvas.add(new fabric.Rect({
                left: mainWingWidth - friezeWidth, 
                top: 0, 
                width: friezeWidth, 
                height: height, 
                fill: '#a86d3b', 
                stroke: '#ffffff', 
                strokeWidth: 1
            }));
            canvas.add(new fabric.Rect({
                left: mainWingWidth, 
                top: 0, 
                width: friezeWidth, 
                height: height, 
                fill: '#a86d3b', 
                stroke: '#ffffff', 
                strokeWidth: 1
            }));
            canvas.add(new fabric.Rect({
                left: width - friezeWidth, 
                top: 0, 
                width: friezeWidth, 
                height: height, 
                fill: '#a86d3b', 
                stroke: '#ffffff', 
                strokeWidth: 1
            }));
        } else {
            // Szimmetrikus kétszárnyú osztók
            var innerHalfWidth = (width/2) - (2 * friezeWidth);
            
            if (verticalDivisionCount > 0) {
                var divSpacing = innerHalfWidth / (verticalDivisionCount + 1);
                // Mindkét szárny osztói
                for (var i = 1; i <= verticalDivisionCount; i++) {
                    // Bal szárny
                    var x1 = friezeWidth + (i * divSpacing);
                    // Jobb szárny
                    var x2 = (width/2) + friezeWidth + (i * divSpacing);
                    
                    // Rajzoljuk meg a függőleges osztókat szegmensenként - bal szárny
                    for (var j = 0; j < segments.length; j++) {
                        var segment = segments[j];
                        canvas.add(new fabric.Rect({
                            left: x1 - verticalDivisionWidth/2,
                            top: segment.top,
                            width: verticalDivisionWidth,
                            height: segment.bottom - segment.top,
                            fill: '#b0b0b0',
                            stroke: '#ffffff',
                            strokeWidth: 1
                        }));
                    }
                    
                    // Rajzoljuk meg a függőleges osztókat szegmensenként - jobb szárny
                    for (var j = 0; j < segments.length; j++) {
                        var segment = segments[j];
                        canvas.add(new fabric.Rect({
                            left: x2 - verticalDivisionWidth/2,
                            top: segment.top,
                            width: verticalDivisionWidth,
                            height: segment.bottom - segment.top,
                            fill: '#b0b0b0',
                            stroke: '#ffffff',
                            strokeWidth: 1
                        }));
                    }
                }
            }

            // Szimmetrikus frízek - fa színű
            canvas.add(new fabric.Rect({
                left: 0, 
                top: 0, 
                width: friezeWidth, 
                height: height, 
                fill: '#a86d3b', 
                stroke: '#ffffff', 
                strokeWidth: 1
            }));
            canvas.add(new fabric.Rect({
                left: width/2 - friezeWidth, 
                top: 0, 
                width: friezeWidth, 
                height: height, 
                fill: '#a86d3b', 
                stroke: '#ffffff', 
                strokeWidth: 1
            }));
            canvas.add(new fabric.Rect({
                left: width/2, 
                top: 0, 
                width: friezeWidth, 
                height: height, 
                fill: '#a86d3b', 
                stroke: '#ffffff', 
                strokeWidth: 1
            }));
            canvas.add(new fabric.Rect({
                left: width - friezeWidth, 
                top: 0, 
                width: friezeWidth, 
                height: height, 
                fill: '#a86d3b', 
                stroke: '#ffffff', 
                strokeWidth: 1
            }));
        }

        // Középvonal - szaggatott vonal - most fehér
        canvas.add(new fabric.Line([mainWingWidth, 0, mainWingWidth, height], {
            stroke: '#ffffff',
            strokeWidth: 1,
            strokeDashArray: [5, 5]
        }));
    } else {
        // Egyszárnyú ajtó osztói és frízei
        var innerWidth = width - (2 * friezeWidth);
        if (verticalDivisionCount > 0) {
            var divSpacing = innerWidth / (verticalDivisionCount + 1);
            console.log("Egyszárnyú ajtó: osztóköz:", divSpacing);
            
            for (var i = 1; i <= verticalDivisionCount; i++) {
                var x = friezeWidth + (i * divSpacing);
                console.log("Függőleges osztó pozíció:", x);
                
                // Rajzoljuk meg a függőleges osztót szegmensenként
                for (var j = 0; j < segments.length; j++) {
                    var segment = segments[j];
                    canvas.add(new fabric.Rect({
                        left: x - verticalDivisionWidth/2,
                        top: segment.top,
                        width: verticalDivisionWidth,
                        height: segment.bottom - segment.top,
                        fill: '#b0b0b0',
                        stroke: '#ffffff',
                        strokeWidth: 1
                    }));
                }
            }
        }
        
        // Egyszárnyú frízek - fa színű
        canvas.add(new fabric.Rect({
            left: 0, 
            top: 0, 
            width: friezeWidth, 
            height: height, 
            fill: '#a86d3b', 
            stroke: '#ffffff', 
            strokeWidth: 1
        }));
        canvas.add(new fabric.Rect({
            left: width - friezeWidth, 
            top: 0, 
            width: friezeWidth, 
            height: height, 
            fill: '#a86d3b', 
            stroke: '#ffffff', 
            strokeWidth: 1
        }));
    }

    console.log("Canvas renderelése...");
    canvas.renderAll();
    console.log("Canvas renderelés befejezve.");
}

    // 6. Beltéri ajtó függvények
    function submitInteriorDoorParams() {
    var params = collectInteriorDoorParams();
    if (params) {
        saveFormValues();
        console.log("Beltéri ajtó paraméterek küldése:", params);
        sketchup.generateComponents(JSON.stringify(params));  // Ez a kulcsfontosságú sor
        drawInteriorDoor(params);
    }
}

    function collectInteriorDoorParams() {
        var frameWoodWidth = document.getElementById('interior_door_frame_wood_width').value;
        var frameWoodThickness = document.getElementById('interior_door_frame_wood_thickness').value;
        var frameWidth = document.getElementById('interior_door_frame_width').value;
        var frameHeight = document.getElementById('interior_door_frame_height').value;
        var doorSashWidthDeduction = document.getElementById('interior_door_sash_width_deduction').value;
        var doorSashHeightDeduction = document.getElementById('interior_door_sash_height_deduction').value;
        var doorCount = document.getElementById('interior_door_count').value;

        var tenonLength = document.getElementById('interior_tenon_length').value;
        var doorFriezeWidth = document.getElementById('interior_door_frieze_width').value;
        var doorFriezeThickness = document.getElementById('interior_door_frieze_thickness').value;

        var lowerTenonedWidth = document.getElementById('interior_lower_tenoned_width').value;
        var lowerTenonedThickness = document.getElementById('interior_lower_tenoned_thickness').value;

        var middleDivisionWidth = document.getElementById('interior_middle_division_width').value;
        var middleDivisionThickness = document.getElementById('interior_middle_division_thickness').value;
        var horizontalDivisions = document.getElementById('interior_horizontal_divisions').value;

        var upperTenonedWidth = document.getElementById('interior_upper_tenoned_width').value;
        var upperTenonedThickness = document.getElementById('interior_upper_tenoned_thickness').value;

        var verticalDivisionWidth = document.getElementById('interior_vertical_division_width').value;
        var verticalDivisionThickness = document.getElementById('interior_vertical_division_thickness').value;
        var verticalDivisions = document.getElementById('interior_vertical_divisions').value;

        if (!frameWoodWidth || !frameWoodThickness || !frameWidth || !frameHeight || !doorCount) {
            alert('Kérjük, töltse ki az összes kötelező mezőt.');
            return null;
        }

        return {
            element_type: "Beltéri ajtó",
            door_frame_wood_width: frameWoodWidth,
            door_frame_wood_thickness: frameWoodThickness,
            door_frame_width: frameWidth,
            door_frame_height: frameHeight,
            door_sash_width_deduction: doorSashWidthDeduction,
            door_sash_height_deduction: doorSashHeightDeduction,
            door_count: doorCount,
            tenon_length: tenonLength,
            door_frieze_width: doorFriezeWidth,
            door_frieze_thickness: doorFriezeThickness,
            lower_tenoned_width: lowerTenonedWidth,
            lower_tenoned_thickness: lowerTenonedThickness,
            middle_division_width: middleDivisionWidth,
            middle_division_thickness: middleDivisionThickness,
            horizontal_divisions: horizontalDivisions,
            upper_tenoned_width: upperTenonedWidth,
            upper_tenoned_thickness: upperTenonedThickness,
            vertical_division_width: verticalDivisionWidth,
            vertical_division_thickness: verticalDivisionThickness,
            vertical_divisions: verticalDivisions
        };
    }

    function drawInteriorDoor(params) {
        interiorCanvas.clear();

        var scale = Math.min(600 / params.door_frame_width, 1000 / params.door_frame_height);
        var width = params.door_frame_width * scale;
        var height = params.door_frame_height * scale;

        // Door frame
        var door = new fabric.Rect({
            left: 0,
            top: 0,
            width: width,
            height: height,
            fill: 'transparent',
            stroke: '#333',
            strokeWidth: 2
        });
        interiorCanvas.add(door);

        // Ajtó frízek
        var friezeWidth = (params.door_frieze_width || 0) * scale;
        var friezeThickness = (params.door_frieze_thickness || 0) * scale;

        // Bal oldali fríz
        var leftFrieze = new fabric.Rect({
            left: 0,
            top: 0,
            width: friezeWidth,
            height: height,
            fill: '#8B4513'
        });
        interiorCanvas.add(leftFrieze);

        // Jobb oldali fríz
        var rightFrieze = new fabric.Rect({
            left: width - friezeWidth,
            top: 0,
            width: friezeWidth,
            height: height,
            fill: '#8B4513'
        });
        interiorCanvas.add(rightFrieze);

        // Függőleges osztók
        var verticalDivisionCount = parseInt(params.vertical_divisions) || 0;
        var verticalDivisionWidth = (params.vertical_division_width || 0) * scale;
        var horizontalPositions = Array.from({length: params.horizontal_divisions}, (_, i) => 
            (i + 1) * height / (parseInt(params.horizontal_divisions) + 1));

        for (var vIndex = 0; vIndex < verticalDivisionCount; vIndex++) {
            for (var segmentIndex = 0; segmentIndex < horizontalPositions.length + 1; segmentIndex++) {
                var yStart = segmentIndex === 0 ? 0 : horizontalPositions[segmentIndex - 1];
                var yEnd = segmentIndex === horizontalPositions.length ? height : horizontalPositions[segmentIndex];
                var x = (vIndex + 1) * width / (verticalDivisionCount + 1);

                var line = new fabric.Line([x, yStart, x, yEnd], {
                    stroke: '#333',
                    strokeWidth: verticalDivisionWidth
                });
                interiorCanvas.add(line);
            }
        }

        interiorCanvas.renderAll();
    }

    // 7. Villanyóra szekrény függvények
    function submitElectricBoxDoorParams() {
    var params = collectElectricBoxDoorParams();
    if (params) {
        saveFormValues();
        console.log("Villanyóra szekrény ajtó paraméterek küldése:", params);
        sketchup.generateComponents(JSON.stringify(params));  // Ez a kulcsfontosságú sor
        drawElectricBoxDoor(params);
    }
}

    function collectElectricBoxDoorParams() {
        var frameWoodWidth = document.getElementById('electric_box_door_frame_wood_width').value;
        var frameWoodThickness = document.getElementById('electric_box_door_frame_wood_thickness').value;
        var frameWidth = document.getElementById('electric_box_door_frame_width').value;
        var frameHeight = document.getElementById('electric_box_door_frame_height').value;
        var doorSashWidthDeduction = document.getElementById('electric_box_door_sash_width_deduction').value;
        var doorSashHeightDeduction = document.getElementById('electric_box_door_sash_height_deduction').value;
        var doorCount = document.getElementById('electric_box_door_count').value;

        var tenonLength = document.getElementById('electric_box_tenon_length').value;
        var doorFriezeWidth = document.getElementById('electric_box_door_frieze_width').value;
        var doorFriezeThickness = document.getElementById('electric_box_door_frieze_thickness').value;

        var lowerTenonedWidth = document.getElementById('electric_box_lower_tenoned_width').value;
        var lowerTenonedThickness = document.getElementById('electric_box_lower_tenoned_thickness').value;

        var middleDivisionWidth = document.getElementById('electric_box_middle_division_width').value;
        var middleDivisionThickness = document.getElementById('electric_box_middle_division_thickness').value;
        var horizontalDivisions = document.getElementById('electric_box_horizontal_divisions').value;

        var upperTenonedWidth = document.getElementById('electric_box_upper_tenoned_width').value;
        var upperTenonedThickness = document.getElementById('electric_box_upper_tenoned_thickness').value;

        var verticalDivisionWidth = document.getElementById('electric_box_vertical_division_width').value;
        var verticalDivisionThickness = document.getElementById('electric_box_vertical_division_thickness').value;
        var verticalDivisions = document.getElementById('electric_box_vertical_divisions').value;

        if (!frameWoodWidth || !frameWoodThickness || !frameWidth || !frameHeight || !doorCount) {
            alert('Kérjük, töltse ki az összes kötelező mezőt.');
            return null;
        }

        return {
            element_type: "Villanyóra szekrény ajtó",
            door_frame_wood_width: frameWoodWidth,
            door_frame_wood_thickness: frameWoodThickness,
            door_frame_width: frameWidth,
            door_frame_height: frameHeight,
            door_sash_width_deduction: doorSashWidthDeduction,
            door_sash_height_deduction: doorSashHeightDeduction,
            door_count: doorCount,
            tenon_length: tenonLength,
            door_frieze_width: doorFriezeWidth,
            door_frieze_thickness: doorFriezeThickness,
            lower_tenoned_width: lowerTenonedWidth,
            lower_tenoned_thickness: lowerTenonedThickness,
            middle_division_width: middleDivisionWidth,
            middle_division_thickness: middleDivisionThickness,
            horizontal_divisions: horizontalDivisions,
            upper_tenoned_width: upperTenonedWidth,
            upper_tenoned_thickness: upperTenonedThickness,
            vertical_division_width: verticalDivisionWidth,
            vertical_division_thickness: verticalDivisionThickness,
            vertical_divisions: verticalDivisions
        };
    }

    function drawElectricBoxDoor(params) {
        electricBoxCanvas.clear();

        var scale = Math.min(600 / params.door_frame_width, 1000 / params.door_frame_height);
        var width = params.door_frame_width * scale;
        var height = params.door_frame_height * scale;

        // Door frame
        var door = new fabric.Rect({
            left: 0,
            top: 0,
            width: width,
            height: height,
            fill: 'transparent',
            stroke: '#333',
            strokeWidth: 2
        });
        electricBoxCanvas.add(door);

        // Ajtó frízek
        var friezeWidth = (params.door_frieze_width || 0) * scale;
        var friezeThickness = (params.door_frieze_thickness || 0) * scale;

        // Bal oldali fríz
        var leftFrieze = new fabric.Rect({
            left: 0,
            top: 0,
            width: friezeWidth,
            height: height,
            fill: '#8B4513'
        });
        electricBoxCanvas.add(leftFrieze);

        // Jobb oldali fríz
        var rightFrieze = new fabric.Rect({
            left: width - friezeWidth,
            top: 0,
            width: friezeWidth,
            height: height,
            fill: '#8B4513'
        });
        electricBoxCanvas.add(rightFrieze);

        // Függőleges osztók
        var verticalDivisionCount = parseInt(params.vertical_divisions) || 0;
        var verticalDivisionWidth = (params.vertical_division_width || 0) * scale;
        var horizontalPositions = Array.from({length: params.horizontal_divisions}, (_, i) => 
            (i + 1) * height / (parseInt(params.horizontal_divisions) + 1));

        for (var vIndex = 0; vIndex < verticalDivisionCount; vIndex++) {
            for (var segmentIndex = 0; segmentIndex < horizontalPositions.length + 1; segmentIndex++) {
                var yStart = segmentIndex === 0 ? 0 : horizontalPositions[segmentIndex - 1];
                var yEnd = segmentIndex === horizontalPositions.length ? height : horizontalPositions[segmentIndex];
                var x = (vIndex + 1) * width / (verticalDivisionCount + 1);

                var line = new fabric.Line([x, yStart, x, yEnd], {
                    stroke: '#333',
                    strokeWidth: verticalDivisionWidth
                });
                electricBoxCanvas.add(line);
            }
        }

        // Vízszintes osztók
        var horizontalDivisionCount = parseInt(params.horizontal_divisions) || 0;
        var horizontalDivisionWidth = (params.middle_division_width || 0) * scale;

        for (var i = 0; i < horizontalPositions.length; i++) {
            var y = horizontalPositions[i];
            var line = new fabric.Line([0, y, width, y], {
                stroke: '#333',
                strokeWidth: horizontalDivisionWidth
            });
            electricBoxCanvas.add(line);
        }

        // Alsó csapos
        var lowerTenonedWidth = (params.lower_tenoned_width || 0) * scale;
        if (lowerTenonedWidth > 0) {
            var lowerTenoned = new fabric.Rect({
                left: 0, 
                top: height - lowerTenonedWidth, 
                width: width, 
                height: lowerTenonedWidth, 
                fill: '#555', 
                stroke: '#333', 
                strokeWidth: 1
            });
            electricBoxCanvas.add(lowerTenoned);
        }

        // Felső csapos
        var upperTenonedWidth = (params.upper_tenoned_width || 0) * scale;
        if (upperTenonedWidth > 0) {
            var upperTenoned = new fabric.Rect({
                left: 0, 
                top: 0, 
                width: width, 
                height: upperTenonedWidth, 
                fill: '#555', 
                stroke: '#333', 
                strokeWidth: 1
            });
            electricBoxCanvas.add(upperTenoned);
        }

        electricBoxCanvas.renderAll();
    }
        // Vízszintes osztók számának figyelése
        document.getElementById('door_horizontal_divisions').addEventListener('change', function() {
            if (document.getElementById('door-manual-settings-checkbox').checked) {
                const count = parseInt(this.value) || 0;
                generateHorizontalInputs(count);
            }
        });
        
        // Manuális beállítások checkbox figyelése
        document.getElementById('door-manual-settings-checkbox').addEventListener('change', function() {
            const manualSettings = document.getElementById('door-manual-settings');
            if (this.checked) {
                manualSettings.style.display = 'block';
                const count = parseInt(document.getElementById('door_horizontal_divisions').value) || 0;
                generateHorizontalInputs(count);
            } else {
                manualSettings.style.display = 'none';
            }
        });
        
        // Beviteli mezők generálása
        function generateHorizontalInputs(count) {
            const container = document.getElementById('door-horizontal-positions');
            container.innerHTML = '';
            
            if (count > 0) {
                // Címke hozzáadása
                const title = document.createElement('h4');
                title.textContent = 'Vízszintes osztók távolságai:';
                title.style.textAlign = 'center';
                container.appendChild(title);
                
                // Info szöveg
                const info = document.createElement('p');
                info.textContent = 'Add meg az osztók közötti távolságokat (mm):';
                info.style.fontSize = '0.9em';
                info.style.color = '#888';
                info.style.textAlign = 'center';
                container.appendChild(info);
        
                // Beviteli mezők generálása minden osztóhoz
                for (let i = 0; i < count; i++) {
                    const div = document.createElement('div');
                    div.className = 'form-item';
                    
                    const label = document.createElement('label');
                    if (i === 0) {
                        label.textContent = 'Alsó csapos és első osztó közti távolság:';
                    } else {
                        label.textContent = `${i}. és ${i+1}. osztó közti távolság:`;
                    }
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.id = `horizontal-distance-${i}`;
                    input.className = 'horizontal-distance';
                    input.step = '0.1';
                    input.min = '0';
                    input.value = ""; // Üres alapértelmezett érték
                    input.addEventListener('input', calculateRemainingDistance); // Eseményfigyelő hozzáadása
                    
                    div.appendChild(label);
                    div.appendChild(input);
                    container.appendChild(div);
                }
                
                // Utolsó osztó és felső csapos közti távolság
                const lastDiv = document.createElement('div');
                lastDiv.className = 'form-item';
                
                const lastLabel = document.createElement('label');
                lastLabel.textContent = 'Utolsó osztó és felső csapos közti távolság:';
                
                const lastInput = document.createElement('div');
                lastInput.id = 'last-distance';
                lastInput.textContent = 'Add meg a többi távolságot...';
                lastInput.style.padding = '10px';
                lastInput.style.backgroundColor = '#333';
                lastInput.style.borderRadius = '4px';
                lastInput.style.textAlign = 'center';
                
                lastDiv.appendChild(lastLabel);
                lastDiv.appendChild(lastInput);
                container.appendChild(lastDiv);
                
                // Inicializáljuk a maradék távolság számítását
                calculateRemainingDistance();
            }
        }
        
        // Maradék távolság számítása
        function calculateRemainingDistance() {
            if (!document.getElementById('door-manual-settings-checkbox').checked) {
                return;
            }

            // Begyűjtjük az értékeket
            const doorHeight = parseFloat(document.getElementById('door_frame_height').value) || 0;
            const doorSashHeightDeduction = parseFloat(document.getElementById('door_sash_height_deduction').value) || 0;
            const divisionWidth = parseFloat(document.getElementById('door_middle_division_width').value) || 0;
            const lowerTenonWidth = parseFloat(document.getElementById('door_lower_tenoned_width').value) || 0;
            const upperTenonWidth = parseFloat(document.getElementById('door_upper_tenoned_width').value) || 0;
            
            const horizontalDivCount = parseInt(document.getElementById('door_horizontal_divisions').value) || 0;

            // Belső magasság számítása a nyíló magasság levonással együtt
            const innerHeight = doorHeight - (lowerTenonWidth + upperTenonWidth + doorSashHeightDeduction);
            
            // Megadott távolságok összegzése
            let totalDistances = 0;
            let allDistancesFilled = true;
            
            // Ellenőrizzük az összes beviteli mezőt
            for (let i = 0; i < horizontalDivCount; i++) {
                const input = document.getElementById(`horizontal-distance-${i}`);
                if (!input) {
                    console.error(`Nem található a ${i}. távolság beviteli mező`);
                    allDistancesFilled = false;
                    break;
                }
                
                const distance = parseFloat(input.value);
                
                if (isNaN(distance)) {
                    allDistancesFilled = false;
                    break;
                }
                
                totalDistances += distance;
            }
            
            // Felhasznált magasság kiszámítása
            // Formula: az osztók közti távolságok összege + az osztók szélessége
            let totalUsedHeight = 0;
            if (allDistancesFilled) {
                // Osztók közti távolságok
                totalUsedHeight += totalDistances;
                
                // Osztók szélessége
                totalUsedHeight += divisionWidth * horizontalDivCount;
            }
            
            // Eredmény megjelenítése
            const lastDistanceElement = document.getElementById('last-distance');
            if (!lastDistanceElement) {
                console.error('Nem található az "utolsó távolság" megjelenítő elem');
                return;
            }
            
            if (!allDistancesFilled) {
                lastDistanceElement.textContent = 'Add meg az összes távolságot...';
                lastDistanceElement.style.color = '#888';
            } else {
                // Az utolsó szegmens hossza a belső magasság mínusz a már felhasznált hossz
                const lastSegmentLength = innerHeight - totalUsedHeight;
                
                if (lastSegmentLength < 0) {
                    lastDistanceElement.textContent = 'HIBA: A megadott távolságok túl nagyok!';
                    lastDistanceElement.style.color = '#ff4444';
                } else {
                    lastDistanceElement.textContent = lastSegmentLength.toFixed(1) + ' mm';
                    lastDistanceElement.style.color = '#4CAF50';
                }
            }
            
            // Konzol naplózás hibakereséshez
            console.log({
                doorHeight,
                divisionWidth,
                lowerTenonWidth,
                upperTenonWidth,
                horizontalDivCount,
                innerHeight,
                totalUsedHeight,
                allDistancesFilled,
                remainingDistance: innerHeight - totalUsedHeight
            });
        }
        // Az ajtó típus változását kezelő függvény
        function handleDoorTypeChange() {
        const doorType = document.getElementById('door_type').value;
        const asymmetricOptions = document.getElementById('asymmetricOptions');
        
        // Küldjük az adatokat a Ruby kódnak
        if (typeof sketchup !== 'undefined') {
            sketchup.doorTypeChanged(JSON.stringify({
                doorType: doorType
            }));
        }

        // Azonnali UI frissítés
        asymmetricOptions.style.display = doorType === 'Kétszárnyú' ? 'block' : 'none';
        if (doorType !== 'Kétszárnyú') {
            document.getElementById('isAsymmetric').checked = false;
            document.getElementById('asymmetricInputs').style.display = 'none';
        }
    }
    
    // Az aszimmetrikus beállítás változását kezelő függvény
    function handleAsymmetricChange() {
        const isAsymmetric = document.getElementById('isAsymmetric').checked;
        const asymmetricInputs = document.getElementById('asymmetricInputs');
        var doorType = document.getElementById('door_type').value;

        if (isAsymmetric && doorType === 'Kétszárnyú') {
        asymmetricInputs.style.display = 'block';
    } else {
        asymmetricInputs.style.display = 'none';
        document.getElementById('mainWingRatio').value = 50;
        document.getElementById('skipNarrowWingVertical').checked = false;
    }

        
        // Küldjük az adatokat a Ruby kódnak
        if (typeof sketchup !== 'undefined') {
            sketchup.updateAsymmetricSettings(JSON.stringify({
                isAsymmetric: isAsymmetric
            }));
        }

        // Azonnali UI frissítés
        asymmetricInputs.style.display = isAsymmetric ? 'block' : 'none';
    }

    // 8. Segédfüggvények
    function saveFormValues() {
        var inputs = document.querySelectorAll('input[type="number"], select');
        inputs.forEach(function(input) {
            localStorage.setItem(input.id, input.value);
        });
    }

    function loadFormValues() {
        var inputs = document.querySelectorAll('input[type="number"], select');
        inputs.forEach(function(input) {
            var savedValue = localStorage.getItem(input.id);
            if (savedValue !== null) {
                input.value = savedValue;
            }
        });
    }

    function updateComponentList(componentList) {
        var contentDiv = document.getElementById('componentListContent');
        contentDiv.innerHTML = '';
        var currentIndex = -1;
        componentList.forEach(function(item) {
            if (item.startsWith('<button')) {
                currentIndex++;
                var updatedItem = item.replace(/deleteWindow\\\\\\\\\\\\\\\\(\\\\\\\\\\\\\\\\d+\\\\\\\\\\\\\\\\)/, 'deleteWindow(' + currentIndex + ')');
                contentDiv.innerHTML += updatedItem + '<br>';
            } else if (item === '') {
                contentDiv.innerHTML += '<hr>';
            } else {
                contentDiv.innerHTML += '<p>' + item + '</p>';
            }
        });
    }

    function deleteWindow(index) {
        console.log('Törlés kérése indexnél:', index);
        sketchup.deleteWindow(index);
    }

    function generateComponents() {
        console.log("Alkatrészek generálása.");
        sketchup.generateWindowParts();
    }

    function updateSaveStatus(message) {
        // Ha nem létezik még a saveStatus div, hozzuk létre
        let statusDiv = document.getElementById('saveStatus');
        if (!statusDiv) {
            statusDiv = document.createElement('div');
            statusDiv.id = 'saveStatus';
            statusDiv.className = 'status-message';
            // A list-actions div után szúrjuk be
            const listActions = document.querySelector('.list-actions');
            listActions.insertAdjacentElement('afterend', statusDiv);
        }
        statusDiv.textContent = message;
        setTimeout(() => {
            statusDiv.textContent = '';
        }, 3000);
    }

    function saveList() {
        const name = prompt("Adja meg a mentés nevét:");
        if (name) {
            const componentList = document.getElementById('componentListContent');
            const components = Array.from(componentList.getElementsByTagName('p'))
                .map(item => item.textContent)
                .filter(text => text.trim() !== '');
            
            if (components.length > 0) {
                sketchup.saveComponentList(name, JSON.stringify(components));
                updateSaveStatus('Lista mentve!');
            } else {
                alert('Nincs menthető elem a listában!');
            }
        }
    }

    function printList() {
        const componentList = document.getElementById('componentListContent');
        if (!componentList) {
            alert('Hiba: Nem található a komponenslista!');
            return;
        }

        const components = Array.from(componentList.getElementsByTagName('p'));
        
        if (components.length > 0) {
            // Word-kompatibilis HTML dokumentum struktúrával
            const printableHtml = `
                <!DOCTYPE html>
                <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                <head>
                    <meta charset="UTF-8">
                    <title>Alkatrészlista</title>
                    <!--[if gte mso 9]>
                    <xml>
                        <w:WordDocument>
                            <w:View>Print</w:View>
                            <w:Zoom>90</w:Zoom>
                            <w:DoNotOptimizeForBrowser/>
                        </w:WordDocument>
                    </xml>
                    <![endif]-->
                    <style>
                        @page {
                            margin: 10mm;
                        }
                        
                        body {
                            font-family: Arial, sans-serif;
                            margin: 0;
                            padding: 0;
                            font-size: 10pt;
                            line-height: 1.2;
                            width: 100%;
                        }
                        
                        h1 {
                            color: #333;
                            text-align: center;
                            font-size: 12pt;
                            margin: 10px 0;
                        }
                        
                        .components {
                            display: flex;
                            flex-wrap: wrap;
                            gap: 20px;
                            margin: 0 2mm;
                        }
                        
                        .group {
                            width: calc(50% - 15px);
                            margin: 0;
                            padding: 10px;
                            border: 1px solid #ccc;
                            border-radius: 5px;
                            box-sizing: border-box;
                            page-break-inside: avoid;
                        }
                        
                        .structure-header {
                            background-color: #f0f0f0;
                            padding: 5px;
                            margin: -10px -10px 10px -10px;
                            font-weight: bold;
                            border-bottom: 1px solid #ccc;
                        }
                        
                        .structure-info {
                            color: #666;
                            margin-bottom: 10px;
                            padding-bottom: 5px;
                            border-bottom: 1px dashed #ccc;
                        }
                        
                        .component {
                            margin: 5px 0;
                            padding: 0;
                        }
                        
                        .print-button {
                            display: block;
                            margin: 20px auto;
                            padding: 10px 20px;
                            background-color: #4CAF50;
                            color: white;
                            border: none;
                            border-radius: 4px;
                            cursor: pointer;
                            font-size: 14px;
                        }
                        
                        .print-button:hover {
                            background-color: #45a049;
                        }
                        
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                            .components { gap: 10px; }
                            .print-button { display: none; }
                        }

                        /* Word specifikus stílusok */
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 10pt;
                        }
                        
                        td, th {
                            border: 1pt solid #ccc;
                            padding: 4pt;
                            text-align: left;
                        }
                        
                        th {
                            background-color: #f0f0f0;
                        }
                    </style>
                </head>
                <body>
                    <h1>Alkatrészlista</h1>
                    <button onclick="window.print()" class="print-button">Nyomtatás</button>
                    <div class="components">
                        ${formatComponentsToGroups(components)}
                    </div>
                    <button onclick="window.print()" class="print-button">Nyomtatás</button>
                </body>
                </html>
            `;
            
            sketchup.printComponentList(printableHtml);
        } else {
            alert('Nincs nyomtatható elem a listában!');
        }
    }

    function formatComponentsToGroups(components) {
        let groups = [];
        let currentGroup = null;
        let currentComponents = [];
        
        components.forEach(comp => {
            const text = comp.textContent.trim();
            
            if (text.includes('Ablak') || text.includes('Ajtó')) {
                if (currentGroup) {
                    groups.push({
                        header: currentGroup,
                        components: [...currentComponents]
                    });
                }
                currentGroup = text;
                currentComponents = [];
            } else if (text.startsWith('Méret:') || text.startsWith('Típus:')) {
                if (currentComponents.length === 0) {
                    currentComponents.push({type: 'info', content: text});
                } else if (currentComponents[0].type === 'info') {
                    currentComponents[0].content += '<br>' + text;
                }
            } else if (text) {
                currentComponents.push({type: 'component', content: text});
            }
        });
        
        if (currentGroup) {
            groups.push({
                header: currentGroup,
                components: [...currentComponents]
            });
        }
        
        return groups.map(group => `
            <div class="group">
                <div class="structure-header">${group.header}</div>
                ${group.components.map(comp => 
                    comp.type === 'info' 
                        ? `<div class="structure-info">${comp.content}</div>`
                        : `<div class="component">${comp.content}</div>`
                ).join('')}
            </div>
        `).join('');
    }
  </script>
   
 </body>
</html>
